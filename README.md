# 加密貨幣資金費率監控

實時監控主要加密貨幣交易所的資金費率，幫助用戶找到最佳的交易機會。
coinglass 累計資金費率有些問題所以自己開發
## 最新更新 (v2.0.8)

### 新功能
- 新增 Gate.io 歷史資金費率支援
  - 實現歷史資金費率 API 整合
  - 支援多時間範圍查詢 (24h/7d/30d)
  - 自動獲取結算間隔
  - 優化數據處理邏輯
- 新增 Gate.io 當前資金費率支援
  - 優化 API 調用邏輯
  - 添加數據驗證機制
  - 改進費率更新流程
- 改進 HyperLiquid 數據處理機制
  - 優化交易對存在性檢查
  - 改進歷史數據獲取邏輯
  - 優化數據分組和計算方式
  - 添加詳細錯誤處理
- 優化數據聚合邏輯
  - 改進間隔檢測機制
  - 優化數據分組算法
  - 提升數據處理效率
- 改進錯誤處理機制
  - 添加更詳細的錯誤日誌
  - 優化錯誤響應格式
  - 改進錯誤恢復機制

### 改進
- 優化資金費率顯示精度
  - 修改所有費率顯示為 3 位小數（原為 4 位小數）
  - 統一主頁和歷史頁面的顯示格式
  - 改進正負費率的顯示對比度
- 更新交易所顏色方案
  - Binance: 紅色 (#FF0000)
  - Bybit: 黃色 (#F3BA2F)
  - Bitget: 湖水綠 (#00CED1)
  - OKX: 黑色/白色 (根據主題自適應)
  - Gate.io: 藍色 (#4183FC)
  - HyperLiquid: 深綠色 (#006400)
- HyperLiquid API 整合優化
  - 改進當前費率檢查邏輯
  - 優化歷史數據批次獲取
  - 改進數據驗證機制
  - 優化錯誤處理流程
- 數據處理優化
  - 改進數據分組邏輯
  - 優化時間間隔計算
  - 提升數據合併效率
  - 改進數據排序機制
- 性能優化
  - 改進批次請求處理
  - 優化數據緩存機制
  - 減少不必要的API調用
  - 提升響應速度
- 優化用戶界面體驗
  - 改進交易所選擇菜單，提升移動端使用體驗
  - 添加菜單背景遮罩，優化交互效果
  - 歷史頁面當無數據時顯示破折號"-"而非空白
  - 修正費率標準化"8H"顯示問題
  - 優化移動裝置下拉菜單層級，修復重疊問題
  - 增加菜單點擊範圍，提升觸控操作便利性

### 支援的交易所
- Binance (8小時結算)
- Bybit (8小時結算)
- OKX (8小時結算)
- Bitget (8小時結算)
- Gate.io (8小時結算)
- HyperLiquid (1小時結算)

## 功能特點

- 實時資金費率監控
- 累計資金費率計算
- 歷史資金費率查詢
- 多交易所數據比較
- 自適應圖表顯示
- 詳細費率記錄查看
- 支援移動端訪問
- 穩定的實時更新機制
- 智能數據驗證
- 優化的用戶界面

## 技術棧

- Next.js
- Chart.js
- Socket.IO
- REST APIs
- WebSocket
- Vercel 部署

## 使用說明

1. 主頁面顯示所有交易所的當前資金費率
2. 點擊幣種可查看詳細歷史數據
3. 支援按交易所篩選
4. 支援 24H/7D/30D 時間範圍切換
   - 可查看對應時間範圍的累計費率
   - 自動計算並顯示總費率
5. 滑鼠懸停可查看詳細費率信息
6. 資金費率實時自動更新
7. 支援數據導出和分析

## 開發計劃

- [ ] 添加更多交易所支援
- [ ] 實現費率提醒功能
- [ ] 添加用戶自定義設置
- [ ] 支援更多時間週期顯示
- [ ] 添加數據分析工具
- [ ] 優化移動端體驗
- [ ] 添加暗色主題支持
- [ ] 實現數據導出功能
- [ ] 優化累計費率計算效能
- [ ] 添加費率趨勢分析

## 部署

項目使用 Vercel 部署，支援自動化部署流程。

## 貢獻

歡迎提交 Issue 和 Pull Request。

## 許可證

MIT License

# 資金費率查詢系統

這是一個多交易所資金費率查詢系統，支持實時和歷史資金費率數據的獲取和顯示。

## 支持的交易所

- Binance (幣安)
- Bybit
- Bitget
- OKX
- Gate.io
- HyperLiquid

## API 端點

### 獲取資金費率歷史

```
GET /api/history/[symbol]
```

#### 參數

- `symbol`: 交易對名稱（不需要包含 USDT，例如：BTC）
- `timeRange`: 時間範圍（可選，預設為 24h）
  - `24h`: 24小時數據
  - `7d`: 7天數據
  - `30d`: 30天數據
- `exchange`: 交易所（可選，預設為 all）
  - `all`: 所有交易所
  - `Binance`: 僅幣安
  - `Bybit`: 僅 Bybit
  - `Bitget`: 僅 Bitget
  - `OKX`: 僅 OKX
  - `Gate.io`: 僅 Gate.io
  - `HyperLiquid`: 僅 HyperLiquid

#### 響應格式

```json
{
  "success": true,
  "symbol": "BTC",
  "data": [
    {
      "exchange": "交易所名稱",
      "time": "時間戳 ISO 格式",
      "rate": "資金費率（百分比）",
      "interval": "結算間隔（小時）",
      "isCurrent": true/false,
      "hourlyRates": [  // 僅 HyperLiquid 數據包含此字段
        {
          "time": "具體時間",
          "rate": "費率",
          "isHourly": true
        }
      ]
    }
  ]
}
```

#### 特殊功能

1. **智能數據分組**
   - 自動檢測各交易所的結算間隔
   - 根據最小間隔進行數據分組
   - 保留詳細的每小時數據（HyperLiquid）

2. **錯誤處理**
   - 交易對不存在時返回空數組
   - API 錯誤時提供詳細錯誤信息
   - 支持請求重試機制

3. **數據優化**
   - 自動過濾無效數據
   - 按時間排序
   - 當前數據優先顯示

## 數據更新頻率

- 當前資金費率：實時
- 歷史數據：
  - 24h 視圖：每 5 天更新一次
  - 7d 視圖：每 10 天更新一次
  - 30d 視圖：每 35 天更新一次

## 使用示例

```javascript
// 獲取 BTC 24小時資金費率
fetch('/api/history/BTC?timeRange=24h')

// 獲取 ETH 在 Binance 的 7 天資金費率
fetch('/api/history/ETH?timeRange=7d&exchange=Binance')

// 獲取 SOL 在所有交易所的 30 天資金費率
fetch('/api/history/SOL?timeRange=30d')
```

## 錯誤處理

系統會返回以下格式的錯誤信息：

```json
{
  "success": false,
  "error": "錯誤描述",
  "details": "詳細錯誤信息",
  "data": []
}
```

## 注意事項

1. HyperLiquid 的數據處理
   - 先檢查交易對是否存在
   - 獲取當前資金費率
   - 分批獲取歷史數據
   - 智能分組和計算平均值

2. 數據限制
   - 每個請求最多返回：
     - 24h：200 條數據
     - 7d：300 條數據
     - 30d：1000 條數據

3. 性能優化
   - 使用批次請求
   - 添加請求延遲避免頻率限制
   - 智能數據緩存

## 開發計劃

- [ ] 添加數據緩存機制
- [ ] 支持更多交易所
- [ ] 添加 WebSocket 實時更新
- [ ] 優化數據聚合算法
- [ ] 添加更多時間範圍選項

## 移動端優化

### 交易所選擇菜單
- 優化移動裝置下拉菜單層級，防止與其他元素重疊
- 增加下拉菜單背景遮罩，提升使用體驗
- 擴大點擊範圍，方便觸控操作
- 優化選項間距和大小，適配小螢幕設備

### 列表顯示
- 固定幣種列，方便水平滾動時參考
- 優化列寬和內容顯示，提升資訊密度
- 添加水平滾動指示器，提示用戶操作方式

### 主題適配
- 優化深色/淺色模式色彩對比度
- 改進陰影和過渡效果，提升視覺體驗
- 針對不同亮度環境下的顯示進行優化

## 交易所顏色方案

為了提供更好的視覺區分，系統中各交易所使用下列顏色標識：

| 交易所 | 顏色代碼 | 顏色描述 |
|--------|----------|----------|
| Binance | #FF0000 | 紅色 |
| Bybit | #F3BA2F | 黃色 |
| Bitget | #00CED1 | 湖水綠 |
| OKX | 自適應 | 黑色/白色 (根據主題) |
| Gate.io | #4183FC | 藍色 |
| HyperLiquid | #006400 | 深綠色 |

此配色方案在圖表和數據顯示中保持一致，幫助用戶快速識別不同交易所的資料。


